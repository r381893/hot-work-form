<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>動火作業單</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>🔥 動火作業單</h1>
            <div class="form-selector">
                <select id="savedFormsList">
                    <option value="">-- 選擇已儲存的表單 --</option>
                </select>
                <button id="helpBtn" class="btn btn-help">❓ 說明</button>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="before">動火(前)</button>
            <button class="tab-btn" data-tab="during">動火(中)</button>
            <button class="tab-btn" data-tab="after">動火(後)</button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">

            <!-- ======================== -->
            <!-- 動火(前) -->
            <!-- ======================== -->
            <div class="tab-panel active" id="panel-before">
                <section class="card section-header section-before">
                    <h2 class="section-title">動火(前)</h2>
                </section>

                <section class="card">
                    <div class="form-group">
                        <label for="beforeDate">日期</label>
                        <input type="date" id="beforeDate">
                    </div>
                    <div class="form-group">
                        <label for="beforeCompany">公司名稱</label>
                        <input type="text" id="beforeCompany" value="南部發電廠機械組修配課">
                    </div>
                    <div class="form-group">
                        <label for="beforeWorkName">工作名稱</label>
                        <input type="text" id="beforeWorkName" placeholder="輸入工作名稱">
                    </div>
                    <div class="form-group">
                        <label for="beforeWorkLocation">工作地點</label>
                        <input type="text" id="beforeWorkLocation" placeholder="輸入工作地點">
                    </div>
                    <div class="form-group">
                        <label>作業時間</label>
                        <div class="time-range">
                            <select id="beforeWorkTimeStart">
                                <option value="">開始時間</option>
                                <option value="07:00">07:00</option>
                                <option value="07:30">07:30</option>
                                <option value="08:00">08:00</option>
                                <option value="08:30">08:30</option>
                                <option value="09:00">09:00</option>
                                <option value="09:30">09:30</option>
                                <option value="10:00">10:00</option>
                                <option value="10:30">10:30</option>
                                <option value="11:00">11:00</option>
                                <option value="11:30">11:30</option>
                                <option value="12:00">12:00</option>
                                <option value="12:30">12:30</option>
                                <option value="13:00">13:00</option>
                                <option value="13:30">13:30</option>
                                <option value="14:00">14:00</option>
                                <option value="14:30">14:30</option>
                                <option value="15:00">15:00</option>
                                <option value="15:30">15:30</option>
                                <option value="16:00">16:00</option>
                                <option value="16:30">16:30</option>
                                <option value="17:00">17:00</option>
                                <option value="17:30">17:30</option>
                                <option value="18:00">18:00</option>
                            </select>
                            <span class="time-separator">~</span>
                            <select id="beforeWorkTimeEnd">
                                <option value="">結束時間</option>
                                <option value="07:00">07:00</option>
                                <option value="07:30">07:30</option>
                                <option value="08:00">08:00</option>
                                <option value="08:30">08:30</option>
                                <option value="09:00">09:00</option>
                                <option value="09:30">09:30</option>
                                <option value="10:00">10:00</option>
                                <option value="10:30">10:30</option>
                                <option value="11:00">11:00</option>
                                <option value="11:30">11:30</option>
                                <option value="12:00">12:00</option>
                                <option value="12:30">12:30</option>
                                <option value="13:00">13:00</option>
                                <option value="13:30">13:30</option>
                                <option value="14:00">14:00</option>
                                <option value="14:30">14:30</option>
                                <option value="15:00">15:00</option>
                                <option value="15:30">15:30</option>
                                <option value="16:00">16:00</option>
                                <option value="16:30">16:30</option>
                                <option value="17:00">17:00</option>
                                <option value="17:30">17:30</option>
                                <option value="18:00">18:00</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="beforeWorkContent">動火作業內容</label>
                        <textarea id="beforeWorkContent" rows="4" placeholder="輸入動火作業內容"></textarea>
                    </div>
                    <div class="footer-note before">
                        <strong>動火前：</strong>氣體測定數值正常、已置備防火毯、滅火器.. 如附相片
                    </div>

                    <!-- Photo Attachment Section -->
                    <div class="photo-section">
                        <label class="photo-label">附加照片（最多3張）</label>
                        <input type="file" id="beforePhotos" accept="image/*" capture="environment" multiple
                            style="display: none;">
                        <button type="button" class="btn btn-add-photo" data-section="before">📷 附加照片</button>
                        <div class="photo-gallery" id="beforePhotoGallery"></div>
                    </div>

                    <button class="btn btn-export-image" data-section="before"
                        style="background-color: #ff9800; width: 100%; margin-top: 16px;">📷 匯出圖片 (Line)</button>
                </section>
            </div>

            <!-- ======================== -->
            <!-- 動火(中) -->
            <!-- ======================== -->
            <div class="tab-panel" id="panel-during">
                <section class="card section-header section-during">
                    <h2 class="section-title">動火(中)</h2>
                </section>

                <section class="card">
                    <div class="form-group">
                        <label for="duringDate">日期</label>
                        <input type="date" id="duringDate">
                    </div>
                    <div class="form-group">
                        <label for="duringCompany">公司名稱</label>
                        <input type="text" id="duringCompany" value="南部發電廠機械組修配課">
                    </div>
                    <div class="form-group">
                        <label for="duringWorkName">工作名稱</label>
                        <input type="text" id="duringWorkName" placeholder="輸入工作名稱">
                    </div>
                    <div class="form-group">
                        <label for="duringWorkLocation">工作地點</label>
                        <input type="text" id="duringWorkLocation" placeholder="輸入工作地點">
                    </div>
                    <div class="form-group">
                        <label>作業時間</label>
                        <div class="time-range">
                            <select id="duringWorkTimeStart">
                                <option value="">開始時間</option>
                                <option value="07:00">07:00</option>
                                <option value="07:30">07:30</option>
                                <option value="08:00">08:00</option>
                                <option value="08:30">08:30</option>
                                <option value="09:00">09:00</option>
                                <option value="09:30">09:30</option>
                                <option value="10:00">10:00</option>
                                <option value="10:30">10:30</option>
                                <option value="11:00">11:00</option>
                                <option value="11:30">11:30</option>
                                <option value="12:00">12:00</option>
                                <option value="12:30">12:30</option>
                                <option value="13:00">13:00</option>
                                <option value="13:30">13:30</option>
                                <option value="14:00">14:00</option>
                                <option value="14:30">14:30</option>
                                <option value="15:00">15:00</option>
                                <option value="15:30">15:30</option>
                                <option value="16:00">16:00</option>
                                <option value="16:30">16:30</option>
                                <option value="17:00">17:00</option>
                                <option value="17:30">17:30</option>
                                <option value="18:00">18:00</option>
                            </select>
                            <span class="time-separator">~</span>
                            <select id="duringWorkTimeEnd">
                                <option value="">結束時間</option>
                                <option value="07:00">07:00</option>
                                <option value="07:30">07:30</option>
                                <option value="08:00">08:00</option>
                                <option value="08:30">08:30</option>
                                <option value="09:00">09:00</option>
                                <option value="09:30">09:30</option>
                                <option value="10:00">10:00</option>
                                <option value="10:30">10:30</option>
                                <option value="11:00">11:00</option>
                                <option value="11:30">11:30</option>
                                <option value="12:00">12:00</option>
                                <option value="12:30">12:30</option>
                                <option value="13:00">13:00</option>
                                <option value="13:30">13:30</option>
                                <option value="14:00">14:00</option>
                                <option value="14:30">14:30</option>
                                <option value="15:00">15:00</option>
                                <option value="15:30">15:30</option>
                                <option value="16:00">16:00</option>
                                <option value="16:30">16:30</option>
                                <option value="17:00">17:00</option>
                                <option value="17:30">17:30</option>
                                <option value="18:00">18:00</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="duringWorkContent">動火作業內容</label>
                        <textarea id="duringWorkContent" rows="4" placeholder="輸入動火作業內容"></textarea>
                    </div>
                    <div class="footer-note during">
                        <strong>動火中：</strong>檢附核准之動火許可單、現場電焊中，氣體連續偵測、已鋪設防火毯、火花無掉落情形.. 如附相片
                    </div>

                    <!-- Photo Attachment Section -->
                    <div class="photo-section">
                        <label class="photo-label">附加照片（最多3張）</label>
                        <input type="file" id="duringPhotos" accept="image/*" capture="environment" multiple
                            style="display: none;">
                        <button type="button" class="btn btn-add-photo" data-section="during">📷 附加照片</button>
                        <div class="photo-gallery" id="duringPhotoGallery"></div>
                    </div>

                    <button class="btn btn-export-image" data-section="during"
                        style="background-color: #ff9800; width: 100%; margin-top: 16px;">📷 匯出圖片 (Line)</button>
                </section>
            </div>

            <!-- ======================== -->
            <!-- 動火(後) -->
            <!-- ======================== -->
            <div class="tab-panel" id="panel-after">
                <section class="card section-header section-after">
                    <h2 class="section-title">動火(後)</h2>
                </section>

                <section class="card">
                    <div class="form-group">
                        <label for="afterDate">日期</label>
                        <input type="date" id="afterDate">
                    </div>
                    <div class="form-group">
                        <label for="afterCompany">公司名稱</label>
                        <input type="text" id="afterCompany" value="南部發電廠機械組修配課">
                    </div>
                    <div class="form-group">
                        <label for="afterWorkName">工作名稱</label>
                        <input type="text" id="afterWorkName" placeholder="輸入工作名稱">
                    </div>
                    <div class="form-group">
                        <label for="afterWorkLocation">工作地點</label>
                        <input type="text" id="afterWorkLocation" placeholder="輸入工作地點">
                    </div>
                    <div class="form-group">
                        <label>作業時間</label>
                        <div class="time-range">
                            <select id="afterWorkTimeStart">
                                <option value="">開始時間</option>
                                <option value="07:00">07:00</option>
                                <option value="07:30">07:30</option>
                                <option value="08:00">08:00</option>
                                <option value="08:30">08:30</option>
                                <option value="09:00">09:00</option>
                                <option value="09:30">09:30</option>
                                <option value="10:00">10:00</option>
                                <option value="10:30">10:30</option>
                                <option value="11:00">11:00</option>
                                <option value="11:30">11:30</option>
                                <option value="12:00">12:00</option>
                                <option value="12:30">12:30</option>
                                <option value="13:00">13:00</option>
                                <option value="13:30">13:30</option>
                                <option value="14:00">14:00</option>
                                <option value="14:30">14:30</option>
                                <option value="15:00">15:00</option>
                                <option value="15:30">15:30</option>
                                <option value="16:00">16:00</option>
                                <option value="16:30">16:30</option>
                                <option value="17:00">17:00</option>
                                <option value="17:30">17:30</option>
                                <option value="18:00">18:00</option>
                            </select>
                            <span class="time-separator">~</span>
                            <select id="afterWorkTimeEnd">
                                <option value="">結束時間</option>
                                <option value="07:00">07:00</option>
                                <option value="07:30">07:30</option>
                                <option value="08:00">08:00</option>
                                <option value="08:30">08:30</option>
                                <option value="09:00">09:00</option>
                                <option value="09:30">09:30</option>
                                <option value="10:00">10:00</option>
                                <option value="10:30">10:30</option>
                                <option value="11:00">11:00</option>
                                <option value="11:30">11:30</option>
                                <option value="12:00">12:00</option>
                                <option value="12:30">12:30</option>
                                <option value="13:00">13:00</option>
                                <option value="13:30">13:30</option>
                                <option value="14:00">14:00</option>
                                <option value="14:30">14:30</option>
                                <option value="15:00">15:00</option>
                                <option value="15:30">15:30</option>
                                <option value="16:00">16:00</option>
                                <option value="16:30">16:30</option>
                                <option value="17:00">17:00</option>
                                <option value="17:30">17:30</option>
                                <option value="18:00">18:00</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="afterWorkContent">動火作業內容</label>
                        <textarea id="afterWorkContent" rows="4" placeholder="輸入動火作業內容"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="afterCompleteTime">完成時間</label>
                        <select id="afterCompleteTime">
                            <option value="">選擇完成時間</option>
                            <option value="07:00">07:00</option>
                            <option value="07:30">07:30</option>
                            <option value="08:00">08:00</option>
                            <option value="08:30">08:30</option>
                            <option value="09:00">09:00</option>
                            <option value="09:30">09:30</option>
                            <option value="10:00">10:00</option>
                            <option value="10:30">10:30</option>
                            <option value="11:00">11:00</option>
                            <option value="11:30">11:30</option>
                            <option value="12:00">12:00</option>
                            <option value="12:30">12:30</option>
                            <option value="13:00">13:00</option>
                            <option value="13:30">13:30</option>
                            <option value="14:00">14:00</option>
                            <option value="14:30">14:30</option>
                            <option value="15:00">15:00</option>
                            <option value="15:30">15:30</option>
                            <option value="16:00">16:00</option>
                            <option value="16:30">16:30</option>
                            <option value="17:00">17:00</option>
                            <option value="17:30">17:30</option>
                            <option value="18:00">18:00</option>
                        </select>
                    </div>
                    <div class="footer-note after">
                        <strong>動火後：</strong>現場作業已於<span
                            class="complete-time-display"></span>完成，並完成環境整理無殘留火星，已填報火災預防收工前巡檢紀錄。如附相片
                    </div>

                    <!-- Photo Attachment Section -->
                    <div class="photo-section">
                        <label class="photo-label">附加照片（最多3張）</label>
                        <input type="file" id="afterPhotos" accept="image/*" capture="environment" multiple
                            style="display: none;">
                        <button type="button" class="btn btn-add-photo" data-section="after">📷 附加照片</button>
                        <div class="photo-gallery" id="afterPhotoGallery"></div>
                    </div>

                    <button class="btn btn-export-image" data-section="after"
                        style="background-color: #ff9800; width: 100%; margin-top: 16px;">📷 匯出圖片 (Line)</button>
                </section>
            </div>

        </main>

        <!-- Footer Actions -->
        <footer class="footer">
            <button id="saveBtn" class="btn btn-save">
                💾 儲存
            </button>
            <button id="deleteBtn" class="btn btn-delete">
                🗑️ 刪除
            </button>
        </footer>
    </div>

    <!-- Type: Image Preview Modal -->
    <div id="imagePreviewModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3 style="text-align: center; margin-bottom: 10px; color: #333;">長按圖片可分享或儲存</h3>
            <div id="modalImageContainer"></div>
            <div class="modal-actions">
                <button id="downloadImageBtn" class="btn btn-save">💾 下載圖片</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content help-modal-content">
            <span class="close-modal close-help">×</span>
            <h2 style="text-align: center; color: #ff6b35; margin-bottom: 20px;">📋 使用說明</h2>
            <div class="help-content">
                <h3>🔥 動火作業單 - 操作指南</h3>

                <h4>📝 基本操作</h4>
                <ul>
                    <li><strong>切換區段：</strong>點擊上方「動火(前)」「動火(中)」「動火(後)」分頁切換</li>
                    <li><strong>填寫表單：</strong>在各區段填入日期、公司、工作名稱、地點、時間等資訊</li>
                    <li><strong>儲存表單：</strong>點擊底部「💾 儲存」按鈕儲存表單</li>
                    <li><strong>載入表單：</strong>使用頂部下拉選單選擇已儲存的表單</li>
                    <li><strong>刪除表單：</strong>點擊底部「🗑️ 刪除」按鈕刪除當前表單</li>
                </ul>

                <h4>📷 照片附加</h4>
                <ul>
                    <li>每個區段可附加最多 <strong>3 張照片</strong></li>
                    <li>點擊「📷 附加照片」按鈕選擇照片或拍照</li>
                    <li>手機會自動開啟相機讓您拍照</li>
                    <li>點擊照片上的 ✕ 可刪除照片</li>
                </ul>

                <h4>📤 匯出圖片</h4>
                <ul>
                    <li>點擊各區段的「📷 匯出圖片 (Line)」按鈕</li>
                    <li>產生的圖片包含該區段資料及附加照片</li>
                    <li>長按圖片可分享到 Line 或儲存</li>
                </ul>

                <h4>💡 小提示</h4>
                <ul>
                    <li>表單會自動儲存，輸入資料後會自動備份</li>
                    <li>所有資料儲存在您的裝置上，不會上傳到網路</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Toast 通知 -->
    <div id="toast" class="toast"></div>

    <!-- PDF Export Container (Hidden) -->
    <div id="export-container" style="position: absolute; left: -9999px; top: 0; width: 297mm;"></div>

    <script src="app.js"></script>
</body>

</html>